<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title><%= APP_NAME %>: <%= @page_title || controller.action_name %></title>
  <%= render :partial=>'layouts/global_includes' %>
</head>
<body>
  <div id="throbber" style="display:none">
  <div id="skrim" style="width:100%;height:100%;position:absolute;z-index:2;opacity:0.7;background-color:#fff;border:1px inset #000;color:#000;font-size:110%;">
  </div>
   <div id="message" class="throbber_message"><%= image_tag 'ajax-loader.gif' %>&nbsp;&nbsp;Loading...</div>
  </div>
  <div id="topNav">
		<%= render :partial=>'shared/page/header'%>
	</div>
	  <%= display_flash_message %>
  <div id="applicationHeader" style="height:40px;">
    <% if current_user %>
    <div id="search_form" style="position:absolute;right:10px;">
    <%= form_tag :controller => 'search', :action => 'all' %>
  	  <input class="searchField" type="text" name='id' tabindex="1" alt="search box" />
  	  <input class="searchSubmit" type="submit" value="Search" alt="search button" />
    <%= end_form_tag %>
    </div>
    <% 
    #comment this out for now, because of scoping issues related to traversing the ancestors of a category
    if false %>
      <div id="breadcrumb">
        <ul>
          <li><%= link_to "List Categories", :controller=>'category', :action=>'list' %></li>
          <%= yield :bread_crumbs %>
        </ul>
      </div>
      <% end -%>
    <% end -%>
    <%= yield :application_header %>
  	</div>
  	<div id="pageContent">
	<table width="100%">
		<tr>
				<% if current_user 
				  display_open_as  = display_close_as = "none"
				  if session[:view][:expand_menu]
				    display_open_as  = "block"
				  else
				    display_close_as = "block"
			    end
				-%>
			<td id="sideMenu" valign="top" width="250">
				<div style="border-right:1px solid #cfcfcf;width:250px;display:<%= display_open_as %>;">
				  <a href="#" onclick="View.flip_flop('sideMenu','sideMenuCollapsed');new Ajax.Request('/account/toggle_menu');"><%= image_tag('/images/icons/arrow_left.png', {:style=>"display:block;position:absolute;left:240px;padding:1px;border: 1px solid #ccc;"})%></a>
				
				  <ul id="sideMenuNav">  
					  <li><%= link_to 'Inbox', :controller=>'inbox' %></li>
					  <li><%= link_to 'Profile', :controller=>'account',:action=>'my_profile' %></li>
					  <li><%= link_to 'Categories', :controller=>'category' %></li>
				  </ul>
				  <div id="menu_content">
				  <% unless params[:controller] == 'inbox' || params[:action] == 'dashboard'-%>
				    <ul class="tree">
  				    <%= parse_tree(session[:category_tree][:root][:children]) %>
  				  </ul>
  				<% else
              if current_user.is_admin? -%>
					  <%= render :partial=>'layouts/admin_side_menu' %>
				  <%  else -%>
					  <%= render :partial=>'layouts/user_side_menu' %>
				  <%  end
            end -%>
				  </div>
				  <br class="clear_both" />
				</div>
			</td>
			<td valign="top">
				<div id="sideMenuCollapsed" style="border-right:1px solid #cfcfcf;width:25px;display:<%= display_close_as %>;">
			<a href="#" onclick="View.flip_flop('sideMenu','sideMenuCollapsed');new Ajax.Request('/account/toggle_menu');"><%= image_tag('/images/icons/arrow_right.png', {:style=>"display:block;padding:1px;border: 1px solid #ccc;"})%></a>
				</div>
			</td>
			
			<% end -%>
				
			<td id="page" valign="top" style="border-left:1px solid #efefef;padding-left:10px;">
				<%= yield :page_view_options %>
				<%= yield :layout %>
			</td>
		</tr>
	</table>
    </div>
	<div id="applicationFooter">
    <%= yield :page_meta %>
    <%= render :partial=>'shared/page/footer'%>
	</div>    
	<%= grail_notify("System Message", flash[:grail])  if flash.keys.include?(:grail) %>
</body>
</html>
